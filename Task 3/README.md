# Архитектура страховой комании Insure Tech

## Основные проблемы и риски, связанные с ростом нагрузки:

* Отсутствие контроля по RPS на группы клиентов: нет rate\burst-limiting на клиентской стороне. Неравномерно распределяются доступные ресурсы. Пример из кейса: клиент использовал запросов больше, чем по договоренности (250 RPS vs 20 RPS) + Нет контроля всплеска нагрузок, не отлажен механизм заглушек и сдерживания клиенсткой стороны, если приложение недоступно.

* Отсутствие наблюдаемости: нет минимального мониторинга и алертинга. Инциденты расследуются по факту жалоб со стороны клиентов.

* Сервисы сильно зависят друг от друга и приложение больше работает как модульный монолит. При падении одной части приложения - неработоспособно все.  Есть риск неконсистентности данных при сбоях в модулях и синхронных коммуникациях.

* Дополнительный вызов при "монолитной" работе - дорогое масштабирование текущей реализации, тк все сильно взаимосвязано.

* Полностью синхронная коммуникация между сервисами: необходимо пересмотреть подход к общению между сервисами внутри приложения.
Пример предложения асинхронных коммуникаций: добавить брокеры\очереди в рамках бизнес-контекстов для получения и отправки данных. Посмотреть в сторону паттерна Transaction log tailing + Debezium, который подхватывает обновленные данные и несет дальше в нужные сервисы для обеспечения консистентности. Клиентская сторона может получать актуальные данные с брокеров либо как консьюмер, либо через websocket коммуникацию.

* Одна core-db для всех важных операций: необходимо посмотреть в сторону создания реплик, возможно, разделить БД по CQRS для улучшения работы БД и последующего снижения нагрузки на один инстанс.

* Аналогичная проблема затрагивает ins-comp-settlement-db, ins-comp-settlement-db - там необходимо посмотреть в сторону репликации БД для повышения отказоусточивости

* Еще одна проблема при работе с инстансами приложений - региональное расположение. В случае, если география клиентов будет сильно отличаться и расти, стоит рассмотреть деплой экземпляров на разных серверах и цодах, принадлежащих разным регионам.
